<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Magnetic Adventure</title>
</head>
<body>
  <!-- Musik intro -->
  <audio id="bgMusic" preload="auto" loop muted>
    <source src="intro-musik/opening.mp3" type="audio/mpeg">
  </audio>

  <!-- Overlay -->
  <div id="overlay">
    <h1>Let's Start an Adventure in the World of Magnets</h1>
    <p>Klik untuk memulai dan mode layar penuh.</p>
    <button id="mulaiBtn">Mulai</button>
  </div>

  <!-- Konten utama -->
  <div id="content" style="display:none">
    <button id="fullscreenBtn">â›¶</button>
    <iframe src="story.html"></iframe>
  </div>

  <script>
    const overlay = document.getElementById("overlay");
    const content = document.getElementById("content");
    const mulaiBtn = document.getElementById("mulaiBtn");
    const fullscreenBtn = document.getElementById("fullscreenBtn");
    const bgMusic = document.getElementById("bgMusic");

    function openFullscreen() {
      if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
      else if (document.documentElement.webkitRequestFullscreen) document.documentElement.webkitRequestFullscreen();
      else if (document.documentElement.msRequestFullscreen) document.documentElement.msRequestFullscreen();
    }

    function fadeInMusic(audio, duration = 2000) {
      audio.volume = 0;
      audio.muted = false;
      audio.play().catch(err => console.log("Autoplay dicegah:", err));
      let step = 0.05;
      let interval = duration / (1 / step);
      let fade = setInterval(() => {
        if (audio.volume < 1) audio.volume = Math.min(1, audio.volume + step);
        else clearInterval(fade);
      }, interval);
    }

    function fadeOutMusic(audio, duration = 2000) {
      let step = 0.05;
      let interval = duration / (1 / step);
      let fade = setInterval(() => {
        if (audio.volume > 0) audio.volume = Math.max(0, audio.volume - step);
        else { audio.pause(); clearInterval(fade); }
      }, interval);
    }

    function startIntroMusicOnce() {
      fadeInMusic(bgMusic, 3000);
      document.removeEventListener("click", startIntroMusicOnce);
      document.removeEventListener("touchstart", startIntroMusicOnce);
    }
    window.addEventListener("load", () => {
      document.addEventListener("click", startIntroMusicOnce);
      document.addEventListener("touchstart", startIntroMusicOnce);
    });

    mulaiBtn.addEventListener("click", () => {
      openFullscreen();
      overlay.style.display = "none";
      content.style.display = "block";
      fadeOutMusic(bgMusic, 3000);

      // mainkan musik utama setelah fade out selesai
      setTimeout(() => {
        const iframe = document.querySelector("iframe").contentWindow;
        if (iframe.playBgSong) iframe.playBgSong();
      }, 3000);
    });
  </script>
</body>
</html>
